-- creating stage tables with identical structure
CREATE TABLE bookstore_dw.stg_orders AS
SELECT
    order_id,
    CAST(order_date AS DATE) AS order_date,  -- convert from string to DATE
    customer_id,
    book_id,
    quantity,
    total_amount,
    payment_method
FROM bookstore_dw.orders_raw;
CREATE TABLE bookstore_dw.stg_customers LIKE bookstore_dw.customers_raw;
CREATE TABLE bookstore_dw.stg_books LIKE bookstore_dw.books_raw;
CREATE TABLE bookstore_dw.stg_date_dim LIKE bookstore_dw.date_dim;

-- cleaning data
INSERT INTO bookstore_dw.stg_orders
SELECT DISTINCT *
FROM bookstore_dw.orders_raw
WHERE quantity > 0 AND total_amount >= 0;

INSERT INTO bookstore_dw.stg_customers
SELECT DISTINCT *
FROM bookstore_dw.customers_raw
WHERE email IS NOT NULL AND name <> '';

INSERT INTO bookstore_dw.stg_books
SELECT DISTINCT *
FROM bookstore_dw.books_raw
WHERE price > 0;

INSERT INTO bookstore_dw.stg_date_dim
SELECT DISTINCT * FROM bookstore_dw.date_dim
WHERE date IS NOT NULL;
